{"version":3,"file":"useAsync.stories-30f9e0f7.js","sources":["../../packages/useAsync/src/useAsync.ts"],"sourcesContent":["import { DependencyList, useRef, useEffect, useDebugValue } from 'react'\nimport { AsyncState } from './types'\nimport { useAsyncFnFactory } from './useAsyncFnFactory'\n\nexport function useAsync<Result = any, Args extends any[] = any[]>(\n  fn: (...args: Args | []) => Promise<Result>,\n  deps: DependencyList = [],\n): useAsync.Controller<Result, Args | []> {\n  const isFirstTimeRenderRef = useRef(true)\n  const isFirstTimeMountRef = useRef(true)\n\n  const res = useAsyncFnFactory(\n    () =>\n      (...args) =>\n        fn(...args),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    deps,\n    isFirstTimeRenderRef.current ? { loading: true, promise: fn() } : undefined,\n  ) as useAsync.Controller<Result, Args | []>\n  if (isFirstTimeRenderRef.current) isFirstTimeRenderRef.current = false\n\n  const [, reRun] = res\n  useEffect(\n    () => {\n      // Skip `reRun` when component first time mounted, because we have already\n      // executed `fn` before\n      if (isFirstTimeMountRef.current) {\n        isFirstTimeMountRef.current = false\n      } else {\n        void reRun()\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [...deps, reRun],\n  )\n\n  useDebugValue(res)\n\n  return res\n}\n\nexport namespace useAsync {\n  export type State<T> =\n    | AsyncState.Loading<T>\n    | AsyncState.Success<T>\n    | AsyncState.Failed<T>\n\n  export type AsyncFn<\n    Result = any,\n    Args extends any[] = any[],\n  > = useAsyncFnFactory.AsyncFn<Result, Args>\n\n  export type Controller<Result = any, Args extends any[] = any[]> = [\n    State<Result>,\n    AsyncFn<AsyncState.Settled<Result>, Args>,\n  ]\n}\n"],"names":["useAsync","fn","deps","isFirstTimeRenderRef","useRef","isFirstTimeMountRef","res","useAsyncFnFactory","args","reRun","useEffect","useDebugValue"],"mappings":"+LAIO,SAASA,EACdC,EACAC,EAAuB,GACiB,CAClC,MAAAC,EAAuBC,SAAO,EAAI,EAClCC,EAAsBD,SAAO,EAAI,EAEjCE,EAAMC,EACV,IACE,IAAIC,IACFP,EAAG,GAAGO,CAAI,EAEdN,EACAC,EAAqB,QAAU,CAAE,QAAS,GAAM,QAASF,EAAA,CAAS,EAAA,MAAA,EAEhEE,EAAqB,UAASA,EAAqB,QAAU,IAE3D,KAAA,CAAG,CAAAM,CAAK,EAAIH,EAClBI,OAAAA,EAAA,UACE,IAAM,CAGAL,EAAoB,QACtBA,EAAoB,QAAU,GAEzBI,EAAM,CAEf,EAEA,CAAC,GAAGP,EAAMO,CAAK,CAAA,EAGjBE,EAAA,cAAcL,CAAG,EAEVA,CACT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}