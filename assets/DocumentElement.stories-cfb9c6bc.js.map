{"version":3,"file":"DocumentElement.stories-cfb9c6bc.js","sources":["../../packages/DocumentElement/src/DocumentElement.tsx"],"sourcesContent":["import {\n  CSSProperties,\n  ReactNode,\n  ReactElement,\n  FunctionComponent,\n} from 'react'\nimport withSideEffect from 'react-side-effect'\nimport { SimpleJSON, ExcludeKey } from '@c4605/ts-types'\n\nexport interface DocumentElementProps {\n  className?: string\n  style?: CSSProperties & SimpleJSON\n  children?: ReactNode\n}\n\nexport const _DocumentElementInner: FunctionComponent<DocumentElementProps> = ({\n  children,\n}) => (children || null) as ReactElement\n\nfunction mergeClassNames(classNames: string[]): string {\n  const classNameSet = new Set(classNames.join(' ').split(' '))\n  return Array.from(classNameSet).filter(Boolean).join(' ')\n}\n\nfunction reducePropsToState(\n  propsList: DocumentElementProps[],\n): Required<ExcludeKey<DocumentElementProps, 'children'>> {\n  const mergedStyle = Object.assign({}, ...propsList.map(p => p.style || {}))\n  const classNames = propsList.map(p => p.className || '')\n\n  return {\n    style: mergedStyle,\n    className: mergeClassNames(classNames),\n  }\n}\n\nfunction handleStateChangeOnClient(\n  props: ReturnType<typeof reducePropsToState>,\n): void {\n  const { documentElement } = document\n  const { style } = props\n\n  documentElement.style.cssText = ''\n  if (style) {\n    // jsdom not support css variable\n    // https://github.com/jsdom/jsdom/issues/1895\n    // istanbul ignore next\n    Object.keys(style).forEach(k =>\n      documentElement.style.setProperty(k, style[k]),\n    )\n  }\n\n  const nextClassName = props.className || ''\n  if (nextClassName !== documentElement.className) {\n    documentElement.className = nextClassName\n  }\n}\n\nexport const DocumentElement = withSideEffect(\n  reducePropsToState,\n  handleStateChangeOnClient,\n)(_DocumentElementInner)\n"],"names":["_DocumentElementInner","children","mergeClassNames","classNames","classNameSet","reducePropsToState","propsList","mergedStyle","p","handleStateChangeOnClient","props","documentElement","style","k","nextClassName","DocumentElement","withSideEffect"],"mappings":"qIAeO,MAAAA,EAAA,CAAA,CAAwE,SAAAC,CAE/E,IAAAA,GAAA,KAEA,SAAAC,EAAAC,EAAA,CACE,MAAAC,EAAA,IAAA,IAAAD,EAAA,KAAA,GAAA,EAAA,MAAA,GAAA,CAAA,EACA,OAAA,MAAA,KAAAC,CAAA,EAAA,OAAA,OAAA,EAAA,KAAA,GAAA,CACF,CAEA,SAAAC,EAAAC,EAAA,CAGE,MAAAC,EAAA,OAAA,OAAA,CAAA,EAAA,GAAAD,EAAA,IAAAE,GAAAA,EAAA,OAAA,CAAA,CAAA,CAAA,EACAL,EAAAG,EAAA,IAAAE,GAAAA,EAAA,WAAA,EAAA,EAEA,MAAA,CAAO,MAAAD,EACE,UAAAL,EAAAC,CAAA,CAC8B,CAEzC,CAEA,SAAAM,EAAAC,EAAA,CAGE,KAAA,CAAA,gBAAAC,CAAA,EAAA,SACA,CAAA,MAAAC,CAAA,EAAAF,EAEAC,EAAA,MAAA,QAAA,GACAC,GAIE,OAAA,KAAAA,CAAA,EAAA,QAAmBC,GAAAF,EAAA,MAAA,YAAAE,EAAAD,EAAAC,CAAA,CAAA,CAC4B,EAIjD,MAAAC,EAAAJ,EAAA,WAAA,GACAI,IAAAH,EAAA,YACEA,EAAA,UAAAG,EAEJ,CAEO,MAAAC,EAAAC,EAAwBX,EAC7BI,CAEF,EAAAT,CAAA;;;;;;;;;;;;;;;;;;;;"}